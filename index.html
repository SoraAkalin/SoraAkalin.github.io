<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>知识储备库</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="知识储备库">
<meta property="og:url" content="http://soraakalin.top/index.html">
<meta property="og:site_name" content="知识储备库">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="SoraAkalin">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="知识储备库" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">知识储备库</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Suche"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Suche"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://soraakalin.top"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-gitlearn" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/uncategorized/gitlearn/" class="article-date">
  <time class="dt-published" datetime="2021-10-09T09:25:46.000Z" itemprop="datePublished">2021-10-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/uncategorized/gitlearn/">Git学习</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>&emsp;&emsp;最近的比赛代码更新太快了，想着是时候学一下怎么在github上管理代码了，也把学习过程记录下来以免忘掉。</p>
<h2 id="git简介"><a href="#git简介" class="headerlink" title="git简介"></a>git简介</h2><p>git相较于普通的文件管理系统，不但能自动帮我记录每次文件的改动，还可以让同事协作编辑，这样就不用自己管理一堆类似的文件了，也不需要把文件传来传去。如果想查看某次改动，只需要在软件里瞄一眼就可以，岂不是很方便？</p>
<p>这个软件用起来就应该像这个样子，能记录每次文件的改动：</p>
<p><img src="https://gitee.com/soraakalin/imageupload/raw/master/gitlearn/git%E7%AE%80%E4%BB%8B.png" alt="git版本管理"></p>
<p>git是一个分布式的版本控制系统，首先，分布式版本控制系统根本没有“中央服务器”，每个人的电脑上都是一个完整的版本库，这样，你工作的时候，就不需要联网了，因为版本库就在你自己的电脑上。既然每个人电脑上都有一个完整的版本库，那多个人如何协作呢？比方说你在自己电脑上改了文件A，你的同事也在他的电脑上改了文件A，这时，你们俩之间只需把各自的修改推送给对方，就可以互相看到对方的修改了。</p>
<p>和集中式版本控制系统相比，分布式版本控制系统的安全性要高很多，因为每个人电脑里都有完整的版本库，某一个人的电脑坏掉了不要紧，随便从其他人那里复制一个就可以了。而集中式版本控制系统的中央服务器要是出了问题，所有人都没法干活了。</p>
<p>在实际使用分布式版本控制系统的时候，其实很少在两人之间的电脑上推送版本库的修改，因为可能你们俩不在一个局域网内，两台电脑互相访问不了，也可能今天你的同事病了，他的电脑压根没有开机。因此，分布式版本控制系统通常也有一台充当“中央服务器”的电脑，但这个服务器的作用仅仅是用来方便“交换”大家的修改，没有它大家也一样干活，只是交换修改不方便而已。</p>
<h2 id="git安装"><a href="#git安装" class="headerlink" title="git安装"></a>git安装</h2><h3 id="在Linux上安装Git"><a href="#在Linux上安装Git" class="headerlink" title="在Linux上安装Git"></a>在Linux上安装Git</h3><p>首先，你可以试着输入git，看看系统有没有安装Git：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git</span><br><span class="line"></span><br><span class="line">The program &#x27;git&#x27; is currently not installed. You can install it by typing:</span><br><span class="line">sudo apt-get install git</span><br></pre></td></tr></table></figure>

<p>像上面的命令，有很多Linux会友好地告诉你Git没有安装，还会告诉你如何安装Git。</p>
<p>如果你碰巧用Debian或Ubuntu Linux，通过一条<code>sudo apt-get install git</code>就可以直接完成Git的安装，非常简单。</p>
<p>如果是其他Linux版本，可以直接通过源码安装。先从Git官网下载源码，然后解压，依次输入：<code>./config</code>，<code>make</code>，<code>sudo make install</code>这几个命令安装就好了。</p>
<h3 id="在Windows上安装git"><a href="#在Windows上安装git" class="headerlink" title="在Windows上安装git"></a>在Windows上安装git</h3><p>在Windows上使用Git，可以从 <a target="_blank" rel="noopener" href="https://git-scm.com/downloads">Git官网</a><br>直接下载安装程序，然后按默认选项安装即可。</p>
<p>安装完成后，在开始菜单里找到“Git”-&gt;“Git Bash”，蹦出一个类似命令行窗口的东西，就说明Git安装成功！</p>
<p>安装完成后，还需要最后一步设置，在命令行输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git config --global user.name &quot;Your Name&quot;</span><br><span class="line">$ git config --global user.email &quot;email@example.com&quot;</span><br></pre></td></tr></table></figure>

<p>因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。你也许会担心，如果有人故意冒充别人怎么办？这个不必担心，首先我们相信大家都是善良无知的群众，其次，真的有冒充的也是有办法可查的。</p>
<p>注意<code>git config</code>命令的<code>--global</code>参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p>
<h2 id="创建版本库"><a href="#创建版本库" class="headerlink" title="创建版本库"></a>创建版本库</h2><p>版本库又名仓库，英文名repository，你可以简单理解成一个目录，这个目录里面的所有文件都可以被Git管理起来，每个文件的修改、删除，Git都能跟踪，以便任何时刻都可以追踪历史，或者在将来某个时刻可以“还原”。</p>
<p>所以，创建一个版本库非常简单，首先，选择一个合适的地方，创建一个空目录：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ mkdir learngit</span><br><span class="line">$ cd learngit</span><br><span class="line">$ pwd</span><br><span class="line">/Users/michael/learngit</span><br></pre></td></tr></table></figure>

<p>使用pwd命令来显示当前目录</p>
<p>第二步，通过git init命令把这个目录变成Git可以管理的仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git init</span><br><span class="line">Initialized empty Git repository in /Users/michael/learngit/.git/</span><br></pre></td></tr></table></figure>

<p>瞬间Git就把仓库建好了，而且告诉你是一个空的仓库（empty Git repository），细心的读者可以发现当前目录下多了一个<code>.git</code>的目录，这个目录是Git来跟踪管理版本库的，没事千万不要手动修改这个目录里面的文件，不然改乱了，就把Git仓库给破坏了。</p>
<p>如果你没有看到<code>.git</code>目录，那是因为这个目录默认是隐藏的，用<code>ls -ah</code>命令就可以看见。</p>
<p>也不一定必须在空目录下创建Git仓库，选择一个已经有东西的目录也是可以的。</p>
<h2 id="将文件添加到版本库"><a href="#将文件添加到版本库" class="headerlink" title="将文件添加到版本库"></a>将文件添加到版本库</h2><p>首先这里再明确一下，所有的版本控制系统，其实只能跟踪文本文件的改动，比如TXT文件，网页，所有的程序代码等等，Git也不例外。版本控制系统可以告诉你每次的改动，比如在第5行加了一个单词“Linux”，在第8行删了一个单词“Windows”。而图片、视频这些二进制文件，虽然也能由版本控制系统管理，但没法跟踪文件的变化，只能把二进制文件每次改动串起来，也就是只知道图片从100KB改成了120KB，但到底改了啥，版本控制系统不知道，也没法知道。</p>
<p>千万不要使用Windows自带的记事本编辑任何文本文件。原因是Microsoft开发记事本的团队使用了一个非常弱智的行为来保存UTF-8编码的文件，他们自作聪明地在每个文件开头添加了0xefbbbf（十六进制）的字符，你会遇到很多不可思议的问题，比如，网页第一行可能会显示一个“?”，明明正确的程序一编译就报语法错误，等等，都是由记事本的弱智行为带来的。</p>
<p>首先，我们先编写一个<code>readme.txt</code>文件并放到git仓库文件夹下</p>
<p>和把大象放到冰箱需要3步相比，把一个文件放到Git仓库只需要两步。</p>
<p>第一步，用命令git add告诉Git，把文件添加到仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git add readme.txt</span><br></pre></td></tr></table></figure>

<p>执行上面的命令，没有任何显示，这就对了，Unix的哲学是“没有消息就是好消息”，说明添加成功。</p>
<p>第二步，用命令<code>git commit</code>告诉Git，把文件提交到仓库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m &quot;wrote a readme file&quot;</span><br><span class="line">[master (root-commit) eaadf4e] wrote a readme file</span><br><span class="line">1 file changed, 2 insertions(+)</span><br><span class="line">create mode 100644 readme.txt</span><br></pre></td></tr></table></figure>

<p>简单解释一下git commit命令，-m后面输入的是本次提交的说明，可以输入任意内容，当然最好是有意义的，这样你就能从历史记录里方便地找到改动记录。</p>
<p>为什么Git添加文件需要<code>add</code>，<code>commit</code>一共两步呢？因为<code>commit</code>可以一次提交很多文件，所以你可以多次<code>add</code>不同的文件，比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add file1.txt</span><br><span class="line">$ git add file2.txt file3.txt</span><br><span class="line">$ git commit -m &quot;add 3 files.&quot;</span><br></pre></td></tr></table></figure>

<h2 id="修改文件并提交至版本库"><a href="#修改文件并提交至版本库" class="headerlink" title="修改文件并提交至版本库"></a>修改文件并提交至版本库</h2><p>使用<code>git status</code>来查看仓库状态</p>
<p>存在文件被修改但没有被add时，显示<strong>no changes added to commit</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">	modified:   readme.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>

<p>已经将文件add后，显示<strong>Changes to be committed</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes to be committed:</span><br><span class="line">  (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line"></span><br><span class="line">	modified:   readme.txt</span><br></pre></td></tr></table></figure>

<p>使用<code>git diff</code>来查看文件修改详情</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git diff readme.txt </span><br><span class="line">diff --git a/readme.txt b/readme.txt</span><br><span class="line">index 46d49bf..9247db6 100644</span><br><span class="line">--- a/readme.txt</span><br><span class="line">+++ b/readme.txt</span><br><span class="line">@@ -1,2 +1,2 @@</span><br><span class="line">-Git is a version control system.</span><br><span class="line">+Git is a distributed version control system.</span><br><span class="line"> Git is free software.</span><br></pre></td></tr></table></figure>

<h2 id="查看提交日志"><a href="#查看提交日志" class="headerlink" title="查看提交日志"></a>查看提交日志</h2><p>使用<code>git log</code>查看提交日志（由最新一次提交开始），其中commit后的字符串为16位版本号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ git log</span><br><span class="line">commit 1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -&gt; master)</span><br><span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span><br><span class="line">Date:   Fri May 18 21:06:15 2018 +0800</span><br><span class="line"></span><br><span class="line">    append GPL</span><br><span class="line"></span><br><span class="line">commit e475afc93c209a690c39c13a46716e8fa000c366</span><br><span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span><br><span class="line">Date:   Fri May 18 21:03:36 2018 +0800</span><br><span class="line"></span><br><span class="line">    add distributed</span><br><span class="line"></span><br><span class="line">commit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0</span><br><span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span><br><span class="line">Date:   Fri May 18 20:59:18 2018 +0800</span><br><span class="line"></span><br><span class="line">    wrote a readme file</span><br></pre></td></tr></table></figure>

<p>简化显示可以加上<code>--pretty=oneline</code>参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ git log --pretty=oneline</span><br><span class="line">1094adb7b9b3807259d8cb349e7df1d4d6477073 (HEAD -&gt; master) append GPL</span><br><span class="line">e475afc93c209a690c39c13a46716e8fa000c366 add distributed</span><br><span class="line">eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0 wrote a readme file</span><br></pre></td></tr></table></figure>

<h2 id="版本回溯"><a href="#版本回溯" class="headerlink" title="版本回溯"></a>版本回溯</h2><p>若要使版本回溯，可以使用<code>git reset</code>命令。git中使用<code>HEAD</code>表示当前版本，若要回溯至上个版本，则使用<code>HEAD^</code>，上上个版本则为<code>HEAD^^</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard HEAD^</span><br><span class="line">HEAD is now at e475afc add distributed</span><br></pre></td></tr></table></figure>

<p>此时再使用<code>git log</code>命令查看提交日志，发现果然没了最新修改的一次提交记录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ git log</span><br><span class="line">commit e475afc93c209a690c39c13a46716e8fa000c366 (HEAD -&gt; master)</span><br><span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span><br><span class="line">Date:   Fri May 18 21:03:36 2018 +0800</span><br><span class="line"></span><br><span class="line">    add distributed</span><br><span class="line"></span><br><span class="line">commit eaadf4e385e865d25c48e7ca9c8395c3f7dfaef0</span><br><span class="line">Author: Michael Liao &lt;askxuefeng@gmail.com&gt;</span><br><span class="line">Date:   Fri May 18 20:59:18 2018 +0800</span><br><span class="line"></span><br><span class="line">    wrote a readme file</span><br></pre></td></tr></table></figure>

<p>那如何再使版本恢复到原来的状态呢，方法很简单，同样使用<code>git reset</code>命令，不过不同的是这里要使用<code>commit id</code>后面跟的版本号来回溯。当然，版本号并不需要全部写出，只需写出前几位即可。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git reset --hard 1094a</span><br><span class="line">HEAD is now at 83b0afe append GPL</span><br></pre></td></tr></table></figure>

<p>这样便又将版本库的状态回归到原来了，很神奇是不是？这其实是因为git内部有一个指向当前版本的<code>HEAD</code>指针，当回退版本时git只是将这个指针改变了而已</p>
<p>但同时如果一不小心将git bash关闭了，找不到<code>commit id</code>了，这该如何是好呢？别急，git还提供了一个<code>git reflog</code>命令来记录每一次命令，便可以查看到其<code>commit id</code>了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git reflog</span><br><span class="line">e475afc HEAD@&#123;1&#125;: reset: moving to HEAD^</span><br><span class="line">1094adb (HEAD -&gt; master) HEAD@&#123;2&#125;: commit: append GPL</span><br><span class="line">e475afc HEAD@&#123;3&#125;: commit: add distributed</span><br><span class="line">eaadf4e HEAD@&#123;4&#125;: commit (initial): wrote a readme file</span><br></pre></td></tr></table></figure>

<h2 id="工作区与缓存区"><a href="#工作区与缓存区" class="headerlink" title="工作区与缓存区"></a>工作区与缓存区</h2><p>先解释一下相关概念</p>
<h3 id="工作区（Working-Directory）"><a href="#工作区（Working-Directory）" class="headerlink" title="工作区（Working Directory）"></a>工作区（Working Directory）</h3><p>就是你在电脑里能看到的目录，比如<code>learngit</code>文件夹就是一个工作区：</p>
<h3 id="版本库（Repository）"><a href="#版本库（Repository）" class="headerlink" title="版本库（Repository）"></a>版本库（Repository）</h3><p>工作区有一个隐藏目录<code>.git</code>，这个不算工作区，而是Git的版本库。</p>
<p>Git的版本库里存了很多东西，其中最重要的就是称为stage（或者叫index）的暂存区，还有Git为我们自动创建的第一个分支<code>master</code>，以及指向<code>master</code>的一个指针叫<code>HEAD</code>。</p>
<p><img src="https://gitee.com/soraakalin/imageupload/raw/master/gitlearn/%E7%89%88%E6%9C%AC%E5%BA%931.png" alt="版本库1"></p>
<p>第一步是用<code>git add</code>把文件添加进去，实际上就是把文件修改添加到暂存区；</p>
<p>第二步是用<code>git commit</code>提交更改，实际上就是把暂存区的所有内容提交到当前分支。</p>
<p>因为我们创建Git版本库时，Git自动为我们创建了唯一一个<code>master</code>分支，所以，现在，<code>git commit</code>就是往<code>master</code>分支上提交更改。</p>
<p>可以简单理解为，需要提交的文件修改通通放到暂存区，然后，一次性提交暂存区的所有修改。</p>
<p>而<code>git add</code>命令实际上就是把要提交的所有修改放到暂存区（Stage），然后，执行<code>git commit</code>就可以一次性把暂存区的所有修改提交到分支。（如图所示）</p>
<p><img src="https://gitee.com/soraakalin/imageupload/raw/master/gitlearn/%E7%89%88%E6%9C%AC%E5%BA%932.png" alt="版本库2"></p>
<p><img src="https://gitee.com/soraakalin/imageupload/raw/master/gitlearn/%E7%89%88%E6%9C%AC%E5%BA%933.png" alt="版本库3"></p>
<p>一旦提交后，如果你又没有对工作区做任何修改，那么工作区就是“干净”的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>

<p>由于git只记录修改而不记录文件，所以每次commit前总要记得<strong>先add再commit</strong></p>
<p>同时又因为这种特性，可以将某一次在工作区的修改撤销掉，只需使用<code>git checkout -- file</code>命令即可将工作区中被修改的文件撤回至上一次使用<code>git add</code>或<code>git commit</code>命令前的状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- readme.txt</span><br></pre></td></tr></table></figure>

<p>如果不小心已经将修改后的文件<code>git add</code>至暂存区了该怎么做才能撤销其暂存区的修改呢？别急，使用<code>git reset HEAD &lt;file&gt;</code>命令就能将暂存区的修改撤销掉（unstage），重新放回工作区。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git reset HEAD readme.txt</span><br><span class="line">Unstaged changes after reset:</span><br><span class="line">M	readme.txt</span><br></pre></td></tr></table></figure>

<p>如果还想将工作区的修改撤回，使用上方的<code>git checkout</code>命令即可。</p>
<h2 id="删除文件"><a href="#删除文件" class="headerlink" title="删除文件"></a>删除文件</h2><p>当你在add一个文件至暂存区后又将其删除时，使用<code>git status</code>命令能立即告诉你哪些文件被删除了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ git status</span><br><span class="line">On branch master</span><br><span class="line">Changes not staged for commit:</span><br><span class="line">  (use &quot;git add/rm &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">  (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line"></span><br><span class="line">	deleted:    test.txt</span><br><span class="line"></span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>

<p>若你确实要删除这个文件，则使用<code>git rm</code>命令将其删除后再使用<code>git commit</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ git rm test.txt</span><br><span class="line">rm &#x27;test.txt&#x27;</span><br><span class="line"></span><br><span class="line">$ git commit -m &quot;remove test.txt&quot;</span><br><span class="line">[master d46f35e] remove test.txt</span><br><span class="line"> 1 file changed, 1 deletion(-)</span><br><span class="line"> delete mode 100644 test.txt</span><br></pre></td></tr></table></figure>

<p>这样这个文件就在版本库中被删除了</p>
<p>而如果你是不小心将其误删了，那也能很方便地将其找回，使用<code>git checkout -- file</code>命令即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git checkout -- test.txt</span><br></pre></td></tr></table></figure>

<p>其中<code>git checkout</code>命令其实是用版本库里的版本替换工作区的版本，无论工作区是修改还是删除，都可以“一键还原”。</p>
<p><strong>特别注意：</strong></p>
<ul>
<li>从来没有被添加到版本库就被删除的文件，是无法恢复的！</li>
<li>如果一个文件已经被提交到版本库，那么你永远不用担心误删，但是要小心，你只能恢复文件到最新版本，你会丢失最近一次提交后你修改的内容。</li>
</ul>
<h2 id="远程仓库"><a href="#远程仓库" class="headerlink" title="远程仓库"></a>远程仓库</h2><p>若只有上面的内容，那git与集中式版本管理系统并无差别，但这里要介绍的远程仓库便只有git能够实现</p>
<p>一般来讲，我们可以找一台电脑充当服务器的角色，每天24小时开机，其他每个人都从这个“服务器”仓库克隆一份到自己的电脑上，并且各自把各自的提交推送到服务器仓库里，也从服务器仓库中拉取别人的提交。</p>
<p>虽然我们完全可以自己搭建一台运行Git的服务器，不过现阶段，为了学Git先搭个服务器绝对是小题大作。好在这个世界上有个叫GitHub的神奇的网站，从名字就可以看出，这个网站就是提供Git仓库托管服务的，所以，只要注册一个GitHub账号，就可以免费获得Git远程仓库。</p>
<p>这里我们在本机上生成ssh密钥，步骤如下：</p>
<p>第1步：创建SSH Key。在用户主目录下，看看有没有.ssh目录，如果有，再看看这个目录下有没有id_rsa和id_rsa.pub这两个文件，如果已经有了，可直接跳到下一步。如果没有，打开Shell（Windows下打开Git Bash），创建SSH Key：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh-keygen -t rsa -C &quot;youremail@example.com&quot;</span><br></pre></td></tr></table></figure>

<p>你需要把邮件地址换成你自己的邮件地址，然后一路回车，使用默认值即可，由于这个Key也不是用于军事目的，所以也无需设置密码。</p>
<p>如果一切顺利的话，可以在用户主目录里找到<code>.ssh</code>目录，里面有<code>id_rsa</code>和<code>id_rsa.pub</code>两个文件，这两个就是SSH Key的秘钥对，<code>id_rsa</code>是私钥，不能泄露出去，<code>id_rsa.pub</code>是公钥，可以放心地告诉任何人。</p>
<p>第2步：登陆GitHub，打开“Account settings”，“SSH Keys”页面：</p>
<p>然后，点“Add SSH Key”，填上任意Title，在Key文本框里粘贴<code>id_rsa.pub</code>文件的内容即可</p>
<h2 id="push-to-GitHub"><a href="#push-to-GitHub" class="headerlink" title="push to GitHub"></a>push to GitHub</h2><p>先在Github上创建一个新的仓库（repository），设置为public状态，然后在git bash上输入命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git remote add origin git@github.com:username/learngit.git</span><br></pre></td></tr></table></figure>

<p>这里origin是远程库名称，是git的默认叫法，username记得换成自己的GitHub用户名</p>
<p>然后我们就可以使用<code>git push</code>命令将本地库的所有内容推送至远程库上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ git push -u origin master</span><br><span class="line">Counting objects: 20, done.</span><br><span class="line">Delta compression using up to 4 threads.</span><br><span class="line">Compressing objects: 100% (15/15), done.</span><br><span class="line">Writing objects: 100% (20/20), 1.64 KiB | 560.00 KiB/s, done.</span><br><span class="line">Total 20 (delta 5), reused 0 (delta 0)</span><br><span class="line">remote: Resolving deltas: 100% (5/5), done.</span><br><span class="line">To github.com:michaelliao/learngit.git</span><br><span class="line"> * [new branch]      master -&gt; master</span><br><span class="line">Branch &#x27;master&#x27; set up to track remote branch &#x27;master&#x27; from &#x27;origin&#x27;.</span><br></pre></td></tr></table></figure>

<p>把本地库的内容推送到远程，用<code>git push</code>命令，实际上是把当前分支<code>master</code>推送到远程。</p>
<p>由于远程库是空的，我们第一次推送<code>master</code>分支时，加上了<code>-u</code>参数，Git不但会把本地的<code>master</code>分支内容推送的远程新的<code>master</code>分支，还会把本地的<code>master</code>分支和远程的<code>master</code>分支关联起来，在以后的推送或者拉取时就可以简化命令。</p>
<p>从现在起，只要本地作了提交，就可以通过命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git push origin master</span><br></pre></td></tr></table></figure>

<p>把本地<code>master</code>分支的最新修改推送至GitHub，现在，你就拥有了真正的分布式版本库！</p>
<h2 id="删除远程库"><a href="#删除远程库" class="headerlink" title="删除远程库"></a>删除远程库</h2><p>删除远程库<br>如果添加的时候地址写错了，或者就是想删除远程库，可以用<code>git remote rm &lt;name&gt;</code>命令。使用前，建议先用<code>git remote -v</code>查看远程库信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git remote -v</span><br><span class="line">origin  git@github.com:michaelliao/learn-git.git (fetch)</span><br><span class="line">origin  git@github.com:michaelliao/learn-git.git (push)</span><br></pre></td></tr></table></figure>

<p>然后，根据名字删除，比如删除<code>origin</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git remote rm origin</span><br></pre></td></tr></table></figure>

<p>此处的“删除”其实是<strong>解除了本地和远程的绑定关系，并不是物理上删除了远程库。远程库本身并没有任何改动。</strong> </p>
<p>要真正删除远程库，需要登录到GitHub，在后台页面找到删除按钮再删除。</p>
<h2 id="从远程库克隆"><a href="#从远程库克隆" class="headerlink" title="从远程库克隆"></a>从远程库克隆</h2><p>首先，登陆GitHub，创建一个新的仓库</p>
<p>我们勾选<code>Initialize this repository with a README</code>，这样GitHub会自动为我们创建一个<code>README.md</code>文件。创建完毕后，可以看到<code>README.md</code>文件</p>
<p>现在，远程库已经准备好了，下一步是用命令git clone克隆一个本地库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ git clone git@github.com:michaelliao/gitskills.git</span><br><span class="line">Cloning into &#x27;gitskills&#x27;...</span><br><span class="line">remote: Counting objects: 3, done.</span><br><span class="line">remote: Total 3 (delta 0), reused 0 (delta 0), pack-reused 3</span><br><span class="line">Receiving objects: 100% (3/3), done.</span><br></pre></td></tr></table></figure>

<p>注意把Git库的地址换成你自己的，然后进入目录看看，已经有README.md文件了：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cd gitskills</span><br><span class="line">$ ls</span><br><span class="line">README.md</span><br></pre></td></tr></table></figure>

<p>如果有多个人协作开发，那么每个人各自从远程克隆一份就可以了。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://soraakalin.top/uncategorized/gitlearn/" data-id="ckujuo0g7000gwouo4ll26466" data-title="Git学习" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-O2Ocoupon" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/uncategorized/O2Ocoupon/" class="article-date">
  <time class="dt-published" datetime="2021-09-24T08:01:54.000Z" itemprop="datePublished">2021-09-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/uncategorized/O2Ocoupon/">天池新人实战赛o2o优惠券使用预测总结</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="赛题分析"><a href="#赛题分析" class="headerlink" title="赛题分析"></a>赛题分析</h2><p>&emsp;&emsp;题目是一个二分类预测问题，判断用户在领取优惠券后是否有在15天内使用，若使用则标签为1，未使用标签为0</p>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p>&emsp;&emsp;在开始前先把所需要的包进行导入</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> xgboost <span class="keyword">as</span> xgb</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line">warnings.filterwarnings(<span class="string">&#x27;ignore&#x27;</span>)  <span class="comment">#不显示警告</span></span><br></pre></td></tr></table></figure>

<h2 id="数据探测"><a href="#数据探测" class="headerlink" title="数据探测"></a>数据探测</h2><p>&emsp;&emsp;第一次接触机器学习赛题，没有这个环节</p>
<h2 id="数据预处理"><a href="#数据预处理" class="headerlink" title="数据预处理"></a>数据预处理</h2><p>&emsp;&emsp;代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prepare</span>(<span class="params">dataset</span>):</span></span><br><span class="line">    <span class="comment"># 源数据</span></span><br><span class="line">    data = dataset.copy()</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 折扣率处理</span></span><br><span class="line">    data[<span class="string">&#x27;is_manjian&#x27;</span>] = data[<span class="string">&#x27;Discount_rate&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">in</span> <span class="built_in">str</span>(x) <span class="keyword">else</span> <span class="number">0</span>)   </span><br><span class="line">    data[<span class="string">&#x27;min_cost_of_manjian&#x27;</span>] = data[<span class="string">&#x27;Discount_rate&#x27;</span>].<span class="built_in">map</span>(</span><br><span class="line">        <span class="keyword">lambda</span> x: -<span class="number">1</span> <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(x) <span class="keyword">else</span> <span class="built_in">int</span>(<span class="built_in">str</span>(x).split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>])) </span><br><span class="line">    data[<span class="string">&#x27;discount_rate&#x27;</span>] = data[<span class="string">&#x27;Discount_rate&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="built_in">float</span>(x) <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(x) <span class="keyword">else</span></span><br><span class="line">    (<span class="built_in">float</span>(<span class="built_in">str</span>(x).split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>]) - <span class="built_in">float</span>(<span class="built_in">str</span>(x).split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>])) / <span class="built_in">float</span>(<span class="built_in">str</span>(x).split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">0</span>])) </span><br><span class="line">    data[<span class="string">&#x27;discount_jian&#x27;</span>] = data[<span class="string">&#x27;Discount_rate&#x27;</span>].<span class="built_in">map</span>(</span><br><span class="line">        <span class="keyword">lambda</span> x: -<span class="number">1</span> <span class="keyword">if</span> <span class="string">&#x27;:&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(x) <span class="keyword">else</span> <span class="built_in">int</span>(<span class="built_in">str</span>(x).split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>]))</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># 距离处理</span></span><br><span class="line">    data[<span class="string">&#x27;Distance&#x27;</span>].fillna(-<span class="number">1</span>, inplace=<span class="literal">True</span>)  </span><br><span class="line">    data[<span class="string">&#x27;Coupon_id&#x27;</span>].fillna(-<span class="number">1</span>, inplace = <span class="literal">True</span>)</span><br><span class="line">    data[<span class="string">&#x27;null_distance&#x27;</span>] = data[<span class="string">&#x27;Distance&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x: <span class="number">1</span> <span class="keyword">if</span> x == -<span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#时间处理</span></span><br><span class="line">    data[<span class="string">&#x27;date_received&#x27;</span>] = pd.to_datetime(data[<span class="string">&#x27;Date_received&#x27;</span>], <span class="built_in">format</span> = <span class="string">&#x27;%Y%m%d&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Date&#x27;</span> <span class="keyword">in</span> data.columns.tolist():</span><br><span class="line">        data[<span class="string">&#x27;date&#x27;</span>] = pd.to_datetime(data[<span class="string">&#x27;Date&#x27;</span>], <span class="built_in">format</span> = <span class="string">&#x27;%Y%m%d&#x27;</span>)    </span><br><span class="line">    data[<span class="string">&#x27;week&#x27;</span>] = data[<span class="string">&#x27;date_received&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x : x.weekday()) </span><br><span class="line">    data[<span class="string">&#x27;is_weekend&#x27;</span>] = data[<span class="string">&#x27;week&#x27;</span>].<span class="built_in">map</span>(<span class="keyword">lambda</span> x : <span class="number">1</span> <span class="keyword">if</span> x == <span class="number">5</span> <span class="keyword">or</span> x == <span class="number">6</span> <span class="keyword">else</span> <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;如源码所示，数据预处理部分有以下处理步骤：</p>
<ul>
<li>对数据集原有特征列的进一步特征提取：如优惠券是否为满减类型、达到满减的最低消费、折扣率、满减金额等</li>
<li>对空值进行填充处理</li>
<li>对时间进行格式化处理、方便提取年月日、是否为工作日或周末等特征</li>
</ul>
<h2 id="数据打标"><a href="#数据打标" class="headerlink" title="数据打标"></a>数据打标</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_label</span>(<span class="params">dataset</span>):</span></span><br><span class="line">   data = dataset.copy()</span><br><span class="line">    </span><br><span class="line">   data[<span class="string">&#x27;label&#x27;</span>] = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: <span class="number">1</span> <span class="keyword">if</span> (x - y).total_seconds() / (<span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span>) &lt;= <span class="number">15</span> <span class="keyword">else</span> <span class="number">0</span>,data[<span class="string">&#x27;date&#x27;</span>],data[<span class="string">&#x27;date_received&#x27;</span>]))   </span><br><span class="line"></span><br><span class="line">   <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;根据题意可知，在15日内使用优惠券的打标为1，这里便用代码对这一说明进行实现</p>
<h2 id="数据划分"><a href="#数据划分" class="headerlink" title="数据划分"></a>数据划分</h2><p>&emsp;&emsp;为了完成训练，我们需要对原始数据进行数据集划分，这里我们将其按照日期划分为三个数据集，分别为训练集、验证集与测试集（trainset、validset、testset）</p>
<p>&emsp;&emsp;在划分数据集时我们常常使用k折交叉验证法，但本赛题为时间序列预测，故使用<strong>时间窗口划分法</strong>则更加合适</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#划分训练集</span></span><br><span class="line">history_set1 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/2/1&#x27;</span>, periods=<span class="number">60</span>))]</span><br><span class="line">middle_set1 = offline[offline[<span class="string">&#x27;date&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/4/1&#x27;</span>, periods=<span class="number">15</span>))]</span><br><span class="line">lable_set1 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/4/16&#x27;</span>, periods=<span class="number">30</span>))]</span><br><span class="line"><span class="comment">#划分验证集</span></span><br><span class="line">history_set2 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/3/1&#x27;</span>, periods=<span class="number">60</span>))]</span><br><span class="line">middle_set2 = offline[offline[<span class="string">&#x27;date&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/5/1&#x27;</span>, periods=<span class="number">15</span>))]</span><br><span class="line">lable_set2 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/5/16&#x27;</span>, periods=<span class="number">30</span>))]</span><br><span class="line"><span class="comment">#划分测试集</span></span><br><span class="line">history_set3 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/4/1&#x27;</span>, periods=<span class="number">60</span>))]</span><br><span class="line">middle_set3 = offline[offline[<span class="string">&#x27;date&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/6/1&#x27;</span>, periods=<span class="number">15</span>))]</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/soraakalin/imageupload/raw/master/o2o%E4%BC%98%E6%83%A0%E5%88%B8%E9%A2%84%E6%B5%8B/%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A3/%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A31.png" alt="时间窗口01"><br><img src="https://gitee.com/soraakalin/imageupload/raw/master/o2o%E4%BC%98%E6%83%A0%E5%88%B8%E9%A2%84%E6%B5%8B/%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A3/%E6%97%B6%E9%97%B4%E7%AA%97%E5%8F%A32.png" alt="时间窗口02"></p>
<h2 id="特征提取"><a href="#特征提取" class="headerlink" title="特征提取"></a>特征提取</h2><p>&emsp;&emsp;特征提取方面，主要使用了pivot透视表来提取众多的组合特征。其思路为以用户、商家、优惠券为主键来提取单个或组合相关的特征。（下面是以用户为主键的部分特征）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_label_feature</span>(<span class="params">label_field,feature_field</span>):</span></span><br><span class="line">    </span><br><span class="line">    data = feature_field.copy()</span><br><span class="line">    data[<span class="string">&#x27;User_id&#x27;</span>] = data[<span class="string">&#x27;User_id&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>) </span><br><span class="line">    data[<span class="string">&#x27;Merchant_id&#x27;</span>] = data[<span class="string">&#x27;Merchant_id&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>) </span><br><span class="line">    data[<span class="string">&#x27;Coupon_id&#x27;</span>] = data[<span class="string">&#x27;Coupon_id&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>) </span><br><span class="line">    data[<span class="string">&#x27;cnt&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    feature = label_field.copy()</span><br><span class="line">    </span><br><span class="line"><span class="comment">#用户特征</span></span><br><span class="line">    <span class="comment"># 用户领券数</span></span><br><span class="line">    keys = [<span class="string">&#x27;User_id&#x27;</span>] </span><br><span class="line">    prefixs = <span class="string">&#x27;simple_&#x27;</span> + <span class="string">&#x27;_&#x27;</span>.join(keys) + <span class="string">&#x27;_&#x27;</span>  </span><br><span class="line">    </span><br><span class="line">    pivot = pd.pivot_table(data, index=keys, values=<span class="string">&#x27;cnt&#x27;</span>, aggfunc=<span class="built_in">len</span>)  </span><br><span class="line">    pivot = pd.DataFrame(pivot).rename(columns=&#123;<span class="string">&#x27;cnt&#x27;</span>: prefixs + <span class="string">&#x27;receive_cnt&#x27;</span>&#125;).reset_index() </span><br><span class="line">    feature = pd.merge(feature, pivot, on=keys, how=<span class="string">&#x27;left&#x27;</span>)  </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#用户领取不同商家的优惠券的数目</span></span><br><span class="line">    pivot = pd.pivot_table(data, index = keys, values = <span class="string">&#x27;Merchant_id&#x27;</span>, aggfunc = <span class="keyword">lambda</span> x: <span class="built_in">len</span>(<span class="built_in">set</span>(x)))</span><br><span class="line">    pivot = pd.DataFrame(pivot).rename(columns = &#123;<span class="string">&#x27;Merchant_id&#x27;</span>: prefixs + <span class="string">&#x27;receive_differ_merchant&#x27;</span>&#125;).reset_index()</span><br><span class="line">    feature = pd.merge(feature, pivot, on = keys, how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    feature.fillna(<span class="number">0</span>, downcast = <span class="string">&#x27;infer&#x27;</span>, inplace = <span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#用户领卷并消费数</span></span><br><span class="line">    pivot = pd.pivot_table(data,index = keys,values = <span class="string">&#x27;cnt&#x27;</span>,aggfunc = <span class="built_in">len</span>)</span><br><span class="line">    pivot = pd.DataFrame(pivot).rename(columns = &#123;<span class="string">&#x27;cnt&#x27;</span>:prefixs + <span class="string">&#x27;receive_cnt&#x27;</span>&#125;).reset_index()</span><br><span class="line">    feature = pd.merge(feature, pivot,on = keys, how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#用户是否第一次/最后一次领卷</span></span><br><span class="line">    tmp = data[keys + [<span class="string">&#x27;Date_received&#x27;</span>]].sort_values([<span class="string">&#x27;Date_received&#x27;</span>],ascending = <span class="literal">True</span>)</span><br><span class="line">    first = tmp.drop_duplicates(keys,keep = <span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">    first[prefixs + <span class="string">&#x27;is_first_received&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    feature = pd.merge(feature,first,on = keys + [<span class="string">&#x27;Date_received&#x27;</span>],how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    feature.fillna(<span class="number">0</span>,downcast = <span class="string">&#x27;infer&#x27;</span>,inplace = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    last = tmp.drop_duplicates(keys,keep = <span class="string">&#x27;last&#x27;</span>)</span><br><span class="line">    last[prefixs + <span class="string">&#x27;is_last_received&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    feature = pd.merge(feature,first,on = keys + [<span class="string">&#x27;Date_received&#x27;</span>],how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    feature.fillna(<span class="number">0</span>,downcast = <span class="string">&#x27;infer&#x27;</span>,inplace = <span class="literal">True</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># #休息日领券</span></span><br><span class="line">    <span class="comment"># feature[&#x27;week&#x27;] = feature[&#x27;date_received&#x27;].map(lambda x: x.weekday())  # 星期几</span></span><br><span class="line">    <span class="comment"># feature[&#x27;is_weekend&#x27;] = feature[&#x27;week&#x27;].map(lambda x: 1 if x == 5 or x == 6 else 0)  # 判断领券日是否为休息日</span></span><br><span class="line">    <span class="comment"># feature = pd.concat([feature, pd.get_dummies(feature[&#x27;week&#x27;], prefix=&#x27;week&#x27;)], axis=1)  # one-hot离散星期几</span></span><br><span class="line">    <span class="comment"># feature.index = range(len(feature))  # 重置index</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#用户是否第一次/最后一次在商家领卷</span></span><br><span class="line">    tmp = data[keys + [<span class="string">&#x27;Date_received&#x27;</span>]].sort_values([<span class="string">&#x27;Date_received&#x27;</span>],ascending = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    first = tmp.drop_duplicates(keys,keep = <span class="string">&#x27;first&#x27;</span>)</span><br><span class="line">    container = np.ones(first.shape[<span class="number">0</span>])</span><br><span class="line">    first.insert(<span class="number">1</span>,prefixs + <span class="string">&#x27;first_received&#x27;</span>,container)</span><br><span class="line">    first[prefixs + <span class="string">&#x27;first_received&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    feature = pd.merge(feature,first,on = keys + [<span class="string">&#x27;Date_received&#x27;</span>],how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    feature.fillna(<span class="number">0</span>,downcast = <span class="string">&#x27;infer&#x27;</span>,inplace = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    last = tmp.drop_duplicates(keys,keep = <span class="string">&#x27;last&#x27;</span>)</span><br><span class="line">    container = np.ones(last.shape[<span class="number">0</span>])</span><br><span class="line">    last.insert(<span class="number">1</span>,prefixs + <span class="string">&#x27;last_received&#x27;</span>,container)</span><br><span class="line">    last[prefixs + <span class="string">&#x27;last_received&#x27;</span>] = <span class="number">1</span></span><br><span class="line">    feature = pd.merge(feature,last,on = keys + [<span class="string">&#x27;Date_received&#x27;</span>],how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    feature.fillna(<span class="number">0</span>,downcast = <span class="string">&#x27;infer&#x27;</span>,inplace = <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#满减为0到100的优惠券领取数</span></span><br><span class="line">    pivot = pd.pivot_table(data[data[<span class="string">&#x27;min_cost_of_manjian&#x27;</span>] &gt;= <span class="number">0</span>][data[<span class="string">&#x27;min_cost_of_manjian&#x27;</span>] &lt;= <span class="number">100</span>],index = keys, values = <span class="string">&#x27;cnt&#x27;</span>, aggfunc = <span class="built_in">len</span>)</span><br><span class="line">    pivot=pd.DataFrame(pivot).rename(columns = &#123;<span class="string">&#x27;cnt&#x27;</span>: prefixs + <span class="string">&#x27;0~100_coupon_receive_cnt&#x27;</span>&#125;).reset_index()</span><br><span class="line">    feature = pd.merge(feature, pivot, on = keys, how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#满减为100到200的优惠券领取数</span></span><br><span class="line">    pivot = pd.pivot_table(data[data[<span class="string">&#x27;min_cost_of_manjian&#x27;</span>] &gt;= <span class="number">100</span>][data[<span class="string">&#x27;min_cost_of_manjian&#x27;</span>] &lt;= <span class="number">200</span>],index = keys, values = <span class="string">&#x27;cnt&#x27;</span>, aggfunc = <span class="built_in">len</span>)</span><br><span class="line">    pivot=pd.DataFrame(pivot).rename(columns = &#123;<span class="string">&#x27;cnt&#x27;</span>: prefixs + <span class="string">&#x27;100~200_coupon_receive_cnt&#x27;</span>&#125;).reset_index()</span><br><span class="line">    feature = pd.merge(feature, pivot, on = keys, how = <span class="string">&#x27;left&#x27;</span>)</span><br><span class="line">    </span><br><span class="line">     <span class="comment">#满减为0到100的优惠券领取率</span></span><br><span class="line">    feature[prefixs + <span class="string">&#x27;0~100_coupon_receive_rate&#x27;</span>] = <span class="built_in">list</span>(</span><br><span class="line">            <span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: x/y <span class="keyword">if</span> y != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>, feature[prefixs + <span class="string">&#x27;0~100_coupon_receive_cnt&#x27;</span>],feature[prefixs + <span class="string">&#x27;0~100_coupon_receive_cnt&#x27;</span>]))</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#满减为50到200的优惠券领取率</span></span><br><span class="line">    feature[prefixs + <span class="string">&#x27;100~200_coupon_receive_rate&#x27;</span>] = <span class="built_in">list</span>(</span><br><span class="line">            <span class="built_in">map</span>(<span class="keyword">lambda</span> x, y: x/y <span class="keyword">if</span> y != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span>, feature[prefixs + <span class="string">&#x27;100~200_coupon_receive_cnt&#x27;</span>],feature[prefixs + <span class="string">&#x27;100~200_coupon_receive_cnt&#x27;</span>]))</span><br></pre></td></tr></table></figure>

<p>这里着重讲一下关于pandas中pivot透视表中的使用方法：</p>
<ol start="0">
<li><p>新增一列为cnt，赋值为1，方便之后的统计特征（data[‘cnt’] = 1）</p>
</li>
<li><p>首先指定一个主键key与特征前缀名prefix</p>
</li>
<li><p>建立pivot表</p>
</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 建立pivot</span></span><br><span class="line">pivot = pd.pivot_table(data, index=key, values=<span class="string">&#x27;cnt&#x27;</span>, aggfunc=<span class="built_in">len</span>)</span><br><span class="line"><span class="comment"># 改名</span></span><br><span class="line">pivot = pd.DataFrame(pivot).rename(columns=&#123;<span class="string">&#x27;cnt&#x27;</span>: prefixs + <span class="string">&#x27;xxx&#x27;</span>&#125;).reset_index()</span><br><span class="line"><span class="comment"># 拼接</span></span><br><span class="line">feature = pd.merge(feature, pivot, on=key, how=<span class="string">&#x27;left&#x27;</span>)</span><br></pre></td></tr></table></figure>




<h2 id="特征工程"><a href="#特征工程" class="headerlink" title="特征工程"></a>特征工程</h2><p>&emsp;&emsp;在提取特征后我们需要对整个数据集进行一些处理再将其送入模型进行训练</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_dataset</span>(<span class="params">history_field, middle_field, label_field</span>):</span></span><br><span class="line">    <span class="comment"># 特征工程</span></span><br><span class="line">    data = get_label_feature(label_field,label_field)   </span><br><span class="line">    data = get_history_feature(data,history_field)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;Date&#x27;</span> <span class="keyword">in</span> data.columns.tolist():  <span class="comment"># 表示训练集和验证集</span></span><br><span class="line">        data.drop([<span class="string">&#x27;Merchant_id&#x27;</span>, <span class="string">&#x27;Discount_rate&#x27;</span>, <span class="string">&#x27;Date&#x27;</span>, <span class="string">&#x27;date_received&#x27;</span>, <span class="string">&#x27;date&#x27;</span>], axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        label = data[<span class="string">&#x27;label&#x27;</span>].tolist()</span><br><span class="line">        data.drop([<span class="string">&#x27;label&#x27;</span>], axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        data[<span class="string">&#x27;label&#x27;</span>] = label</span><br><span class="line">    <span class="keyword">else</span>:  <span class="comment"># 表示测试集</span></span><br><span class="line">        data.drop([<span class="string">&#x27;Merchant_id&#x27;</span>, <span class="string">&#x27;Discount_rate&#x27;</span>, <span class="string">&#x27;date_received&#x27;</span>], axis=<span class="number">1</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># 修正数据类型</span></span><br><span class="line">    data[<span class="string">&#x27;User_id&#x27;</span>] = data[<span class="string">&#x27;User_id&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br><span class="line">    data[<span class="string">&#x27;Coupon_id&#x27;</span>] = data[<span class="string">&#x27;Coupon_id&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br><span class="line">    data[<span class="string">&#x27;Date_received&#x27;</span>] = data[<span class="string">&#x27;Date_received&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br><span class="line">    data[<span class="string">&#x27;Distance&#x27;</span>] = data[<span class="string">&#x27;Distance&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;label&#x27;</span> <span class="keyword">in</span> data.columns.tolist():</span><br><span class="line">        data[<span class="string">&#x27;label&#x27;</span>] = data[<span class="string">&#x27;label&#x27;</span>].<span class="built_in">map</span>(<span class="built_in">int</span>)</span><br><span class="line">    <span class="comment"># 去重</span></span><br><span class="line">    data.drop_duplicates(keep=<span class="string">&#x27;first&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">    data.index = <span class="built_in">range</span>(<span class="built_in">len</span>(data))</span><br><span class="line">    <span class="comment">#返回</span></span><br><span class="line">    <span class="keyword">return</span> data</span><br></pre></td></tr></table></figure>

<h2 id="模型构造"><a href="#模型构造" class="headerlink" title="模型构造"></a>模型构造</h2><p>&emsp;&emsp;在提取完所需要的特征后，我们要对使用的训练模型（这里使用的是xgboost）进行参数调整与输入数据的处理</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">model_xgb</span>(<span class="params">train, test</span>):</span> </span><br><span class="line">    params = &#123;<span class="string">&#x27;booster&#x27;</span>: <span class="string">&#x27;gbtree&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;objective&#x27;</span>: <span class="string">&#x27;binary:logistic&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;eval_metric&#x27;</span>: <span class="string">&#x27;auc&#x27;</span>, </span><br><span class="line">    <span class="string">&#x27;silent&#x27;</span>: <span class="number">1</span>, </span><br><span class="line">    <span class="string">&#x27;eta&#x27;</span>: <span class="number">0.01</span>, </span><br><span class="line">    <span class="string">&#x27;max_depth&#x27;</span>: <span class="number">7</span>, </span><br><span class="line">    <span class="string">&#x27;min_child_weight&#x27;</span>:<span class="number">5</span>, </span><br><span class="line">    <span class="string">&#x27;gamma&#x27;</span>: <span class="number">0.2</span>, </span><br><span class="line">    <span class="string">&#x27;lambda&#x27;</span>: <span class="number">1</span>, </span><br><span class="line">    <span class="string">&#x27;colsample_bylevel&#x27;</span>: <span class="number">0.7</span>, </span><br><span class="line">    <span class="string">&#x27;colsample_bytree&#x27;</span>: <span class="number">0.8</span>, </span><br><span class="line">    <span class="string">&#x27;subsample&#x27;</span>: <span class="number">0.8</span>, </span><br><span class="line">    <span class="string">&#x27;scale_pos_weight&#x27;</span>: <span class="number">1</span>&#125; </span><br><span class="line">    dtrain = xgb.DMatrix(train.drop([<span class="string">&#x27;User_id&#x27;</span>, <span class="string">&#x27;Coupon_id&#x27;</span>, <span class="string">&#x27;Date_received&#x27;</span>, <span class="string">&#x27;label&#x27;</span>], axis=<span class="number">1</span>), label=train[<span class="string">&#x27;label&#x27;</span>]) </span><br><span class="line">    dtest = xgb.DMatrix(test.drop([<span class="string">&#x27;User_id&#x27;</span>, <span class="string">&#x27;Coupon_id&#x27;</span>, <span class="string">&#x27;Date_received&#x27;</span>], axis=<span class="number">1</span>)) </span><br><span class="line">    </span><br><span class="line">    watchlist = [(dtrain, <span class="string">&#x27;train&#x27;</span>)] </span><br><span class="line">    </span><br><span class="line">    model = xgb.train(params, dtrain, num_boost_round=<span class="number">950</span>, evals=watchlist) </span><br><span class="line">    </span><br><span class="line">    predict = model.predict(dtest) </span><br><span class="line">    predict = pd.DataFrame(predict, columns=[<span class="string">&#x27;prob&#x27;</span>]) </span><br><span class="line">    </span><br><span class="line">    result = pd.concat([test[[<span class="string">&#x27;User_id&#x27;</span>, <span class="string">&#x27;Coupon_id&#x27;</span>, <span class="string">&#x27;Date_received&#x27;</span>]], predict], axis=<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 特征重要性 </span></span><br><span class="line">    feat_importance = pd.DataFrame(columns=[<span class="string">&#x27;feature_name&#x27;</span>, <span class="string">&#x27;importance&#x27;</span>]) </span><br><span class="line">    feat_importance[<span class="string">&#x27;feature_name&#x27;</span>] = model.get_score().keys() </span><br><span class="line">    feat_importance[<span class="string">&#x27;importance&#x27;</span>] = model.get_score().values() </span><br><span class="line">    feat_importance.sort_values([<span class="string">&#x27;importance&#x27;</span>], ascending=<span class="literal">False</span>, inplace=<span class="literal">True</span>) </span><br><span class="line">    <span class="keyword">return</span>   result ,  feat_importance</span><br></pre></td></tr></table></figure>

<h2 id="主函数"><a href="#主函数" class="headerlink" title="主函数"></a>主函数</h2><p>&emsp;&emsp;在写完所有函数后，按顺序进行调用并得到训练结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    </span><br><span class="line">    offline = pd.read_csv(<span class="string">&#x27;ccf_offline_stage1_train.csv&#x27;</span>)</span><br><span class="line">    test = pd.read_csv(<span class="string">&#x27;ccf_offline_stage1_test_revised.csv&#x27;</span>)</span><br><span class="line">    <span class="comment">#数据预处理</span></span><br><span class="line">    offline = prepare(offline)</span><br><span class="line">    test = prepare(test)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">#数据打标</span></span><br><span class="line">    offline = get_label(offline)</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">#划分训练集</span></span><br><span class="line">    history_set1 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/2/1&#x27;</span>, periods=<span class="number">60</span>))]</span><br><span class="line">    middle_set1 = offline[offline[<span class="string">&#x27;date&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/4/1&#x27;</span>, periods=<span class="number">15</span>))]</span><br><span class="line">    lable_set1 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/4/16&#x27;</span>, periods=<span class="number">30</span>))]</span><br><span class="line">    <span class="comment">#划分验证集</span></span><br><span class="line">    history_set2 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/3/1&#x27;</span>, periods=<span class="number">60</span>))]</span><br><span class="line">    middle_set2 = offline[offline[<span class="string">&#x27;date&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/5/1&#x27;</span>, periods=<span class="number">15</span>))]</span><br><span class="line">    lable_set2 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/5/16&#x27;</span>, periods=<span class="number">30</span>))]</span><br><span class="line">    <span class="comment">#划分测试集</span></span><br><span class="line">    history_set3 = offline[offline[<span class="string">&#x27;date_received&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/4/1&#x27;</span>, periods=<span class="number">60</span>))]</span><br><span class="line">    middle_set3 = offline[offline[<span class="string">&#x27;date&#x27;</span>].isin(pd.date_range(<span class="string">&#x27;2016/6/1&#x27;</span>, periods=<span class="number">15</span>))]</span><br><span class="line">    lable_set3 = test.copy()</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;构造训练集&#x27;</span>)</span><br><span class="line">    train = get_dataset(history_set1, middle_set1, lable_set1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;构造验证集&#x27;</span>)</span><br><span class="line">    validate = get_dataset(history_set2, middle_set2, lable_set2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;构造测试集&#x27;</span>)</span><br><span class="line">    test = get_dataset(history_set3, middle_set3, lable_set3)</span><br><span class="line">      </span><br><span class="line">    big_train = pd.concat([train,validate], axis=<span class="number">0</span>) </span><br><span class="line">    result, feat_importance = model_xgb(big_train, test) </span><br><span class="line">    result.to_csv(<span class="string">&#x27;o2o-6.csv&#x27;</span>, index=<span class="literal">False</span>, header=<span class="literal">None</span>) </span><br></pre></td></tr></table></figure>

<h2 id="赛后总结"><a href="#赛后总结" class="headerlink" title="赛后总结"></a>赛后总结</h2><p>&emsp;&emsp;由于这是第一次做机器学习相关的赛题，有许多东西当时并没有搞清楚。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://soraakalin.top/uncategorized/O2Ocoupon/" data-id="ckujuo0g00004wouof178gath" data-title="天池新人实战赛o2o优惠券使用预测总结" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-MarkDown" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/uncategorized/MarkDown/" class="article-date">
  <time class="dt-published" datetime="2021-09-17T10:00:30.000Z" itemprop="datePublished">2021-09-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/uncategorized/MarkDown/">MarkDown基本语法</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="一、字体设置"><a href="#一、字体设置" class="headerlink" title="一、字体设置"></a>一、字体设置</h2><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">**需要加粗的字体**</span><br><span class="line"></span><br><span class="line">*需要斜体的字体*</span><br><span class="line"></span><br><span class="line">***需要斜体加粗的字体***</span><br><span class="line"></span><br><span class="line">~~需要删除线的字体~~</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><strong>需要加粗的字体</strong></p>
<p><em>需要斜体的字体</em></p>
<p><em><strong>需要斜体加粗的字体</strong></em></p>
<p><del>需要删除线的字体</del></p>
<h2 id="二、引用设置"><a href="#二、引用设置" class="headerlink" title="二、引用设置"></a>二、引用设置</h2><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;需要引用的内容</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<blockquote>
<p>需要应用的内容</p>
</blockquote>
<h2 id="三、分割线设置"><a href="#三、分割线设置" class="headerlink" title="三、分割线设置"></a>三、分割线设置</h2><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">***</span><br></pre></td></tr></table></figure>

<p>三个及以上的—和***都可以作为分隔符</p>
<p>效果如下：</p>
<hr>
<hr>
<h2 id="四、图片设置"><a href="#四、图片设置" class="headerlink" title="四、图片设置"></a>四、图片设置</h2><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">![图片alt](图片地址 &#x27;&#x27;图片title&#x27;&#x27;)</span><br><span class="line"></span><br><span class="line">图片alt就是显示在图片下面的文字，相当于对图片内容的解释。</span><br><span class="line">图片title是图片的标题，当鼠标移到图片上时显示的内容。title可加可不加</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">![blockchain](https://ss0.bdstatic.com/70cFvHSh_Q1YnxGkpoWK1HF6hhy/it/</span><br><span class="line">u=702257389,1274025419&amp;fm=27&amp;gp=0.jpg &quot;区块链&quot;)</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><img src="https://i.loli.net/2021/09/17/ZPLfAekSBQRM49r.png" alt="贴贴" title="安达与岛村"></p>
<h2 id="五、超链接设置"><a href="#五、超链接设置" class="headerlink" title="五、超链接设置"></a>五、超链接设置</h2><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[超链接名](超链接地址 &quot;超链接title&quot;)</span><br><span class="line">title可加可不加</span><br></pre></td></tr></table></figure>

<p>示例：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[简书](http://jianshu.com)</span><br><span class="line">[百度](http://baidu.com)</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<p><a target="_blank" rel="noopener" href="http://jianshu.com/">简书</a></p>
<p><a target="_blank" rel="noopener" href="http://baidu.com/">百度</a></p>
<h2 id="六、列表设置"><a href="#六、列表设置" class="headerlink" title="六、列表设置"></a>六、列表设置</h2><h3 id="无序列表"><a href="#无序列表" class="headerlink" title="无序列表"></a>无序列表</h3><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- 列表内容</span><br><span class="line">+ 列表内容</span><br><span class="line">* 列表内容</span><br><span class="line"></span><br><span class="line">注意：- + * 跟内容之间都要有一个空格</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<ul>
<li>列表内容</li>
</ul>
<ul>
<li>列表内容</li>
</ul>
<ul>
<li>列表内容</li>
</ul>
<h3 id="有序列表"><a href="#有序列表" class="headerlink" title="有序列表"></a>有序列表</h3><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 列表内容</span><br><span class="line">2. 列表内容</span><br><span class="line">3. 列表内容</span><br><span class="line"></span><br><span class="line">注意：序号跟内容之间要有空格</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<ol>
<li>列表内容</li>
<li>列表内容</li>
<li>列表内容</li>
</ol>
<h3 id="列表嵌套"><a href="#列表嵌套" class="headerlink" title="列表嵌套"></a>列表嵌套</h3><p>上下级之间加三个空格</p>
<p>效果如下：</p>
<ul>
<li>第一级<ul>
<li>第二级<ul>
<li>第三级</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="七、表格设置"><a href="#七、表格设置" class="headerlink" title="七、表格设置"></a>七、表格设置</h2><p>具体语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">表头|表头|表头</span><br><span class="line">---|:--:|---:</span><br><span class="line">内容|内容|内容</span><br><span class="line">内容|内容|内容</span><br><span class="line"></span><br><span class="line">第二行分割表头和内容。</span><br><span class="line">- 有一个就行，为了对齐，多加了几个</span><br><span class="line">文字默认居左</span><br><span class="line">-两边加：表示文字居中</span><br><span class="line">-右边加：表示文字居右</span><br><span class="line">注：原生的语法两边都要用 | 包起来。此处省略</span><br></pre></td></tr></table></figure>

<p>效果如下：</p>
<table>
<thead>
<tr>
<th>姓名</th>
<th align="center">技能</th>
<th align="right">排行</th>
</tr>
</thead>
<tbody><tr>
<td>刘备</td>
<td align="center">哭</td>
<td align="right">大哥</td>
</tr>
<tr>
<td>关羽</td>
<td align="center">打</td>
<td align="right">二哥</td>
</tr>
<tr>
<td>张飞</td>
<td align="center">骂</td>
<td align="right">三弟</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://soraakalin.top/uncategorized/MarkDown/" data-id="ckujuo0fz0003wouo45ubecvo" data-title="MarkDown基本语法" class="article-share-link">Teilen</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-hello-world" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/uncategorized/hello-world/" class="article-date">
  <time class="dt-published" datetime="2021-09-17T03:12:40.697Z" itemprop="datePublished">2021-09-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/uncategorized/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://soraakalin.top/uncategorized/hello-world/" data-id="ckujuo0g10005wouo4bojerk5" data-title="Hello World" class="article-share-link">Teilen</a>
      
      
      
    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%AD%A6%E4%B9%A0/" rel="tag">学习</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" rel="tag">机器学习</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E5%AD%A6%E4%B9%A0/" style="font-size: 20px;">学习</a> <a href="/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" style="font-size: 10px;">机器学习</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archiv</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">十月 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">letzter Beitrag</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/uncategorized/gitlearn/">Git学习</a>
          </li>
        
          <li>
            <a href="/uncategorized/O2Ocoupon/">天池新人实战赛o2o优惠券使用预测总结</a>
          </li>
        
          <li>
            <a href="/uncategorized/MarkDown/">MarkDown基本语法</a>
          </li>
        
          <li>
            <a href="/uncategorized/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 SoraAkalin<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>